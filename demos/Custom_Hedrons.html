<!DOCTYPE html>
<html>
<head>
    <title>Random hedron</title>
    <link rel="stylesheet" type="text/css" href="./libs/style.css" />
</head>
<body>
    <div class="spinner" id="spinner">
        <div></div>
        <div></div>
        <div></div>
        <div></div>
    </div>
    <div id="stats"></div>
    <div id="samplesPassed"></div>
    <script type="text/javascript" src="./libs/libraries.js"></script>

    <script type="text/javascript" src="../dist/output.js"></script>

    <script type="text/javascript">
        var MyScene = (function (_super) {
            __extends(MyScene, _super);
            function MyScene() {
                _super.call(this, "App", new MB.GLContextW2());
                this.camera = new MB.Camera2(new MB.Vect3(3.91, -4.52, 60.35));
                this.angle = 0;
                this.identityMatrix = MB.Mat4.identity.clone();
                this.model = new MB.Mat4();
            };
            MyScene.prototype.initialize = function () {
                var _this = this;

                var indices = [
                     0, 16,  8, 22,
                     0, 28, 44, 18,
                     0, 32,  6, 12,
                     1, 16, 10, 19,
                     1, 33, 49, 23,
                     1, 29,  5, 13,
                     2, 17, 11, 20,
                     2, 30, 46, 24,
                     2, 26,  4, 12,
                     3, 17,  9, 25,
                     3, 27, 43, 21,
                     3, 31,  7, 13,
                     4, 12,  0, 28,
                     4, 35, 43, 26,
                     4, 37,  9, 14,
                     5, 13,  3, 27,
                     5, 36, 44, 29,
                     5, 34,  8, 14,
                     6, 12,  2, 30,
                     6, 41, 49, 32,
                     6, 39, 10, 15,
                     7, 13,  1, 33,
                     7, 38, 46, 31,
                     7, 40, 11, 15,
                     8, 14,  4, 35,
                     8, 22, 46, 34,
                     8, 23,  1, 16,
                     9, 14,  5, 36,
                     9, 25, 49, 37,
                     9, 24,  2, 17,
                    10, 15,  7, 38,
                    10, 19, 43, 39,
                    10, 18,  0, 16,
                    11, 15,  6, 41,
                    11, 20, 44, 40,
                    11, 21,  3, 17,
                    42, 20,  2, 26,
                    42, 38, 10, 18,
                    42, 27,  5, 34,
                    43, 21, 45, 19,
                    43, 26, 42, 27,
                    43, 39, 47, 35,
                    44, 18, 42, 20,
                    44, 29, 45, 28,
                    44, 40, 48, 36,
                    45, 19,  1, 29,
                    45, 41, 11, 21,
                    45, 28,  4, 37,
                    46, 24, 48, 22,
                    46, 31, 47, 30,
                    46, 34, 42, 38,
                    47, 25,  3, 31,
                    47, 35,  8, 23,
                    47, 30,  6, 39,
                    48, 22,  0, 32,
                    48, 36,  9, 24,
                    48, 33,  7, 40,
                    49, 23, 47, 25,
                    49, 32, 48, 33,
                    49, 37, 45, 41
                ];

                var C0 = 0.414589803375031545538623949690;  //3 * (5 - sqrt(5)) / 20
                var C1 = 0.618033988749894848204586834366;  //(sqrt(5) - 1) / 2
                var C2 = 0.670820393249936908922752100619;  //3 * sqrt(5) / 10
                var C3 = 1.08541019662496845446137605031;   //3 * (5 + sqrt(5)) / 20
                var C4 = 1.34164078649987381784550420124;   //3 * sqrt(5) / 5
                var C5 = 1.61803398874989484820458683437;   //(1 + sqrt(5)) / 2

                this.customHedron0 = new MB.Polyhedron(this.context,
                    [
                        0.0,   C1,   C5,
                        0.0,   C1,  -C5,
                        0.0,  -C1,   C5,
                        0.0,  -C1,  -C5,
                         C5,  0.0,   C1,
                         C5,  0.0,  -C1,
                        -C5,  0.0,   C1,
                        -C5,  0.0,  -C1,
                         C1,   C5,  0.0,
                         C1,  -C5,  0.0,
                        -C1,   C5,  0.0,
                        -C1,  -C5,  0.0,
                        0.0,  0.0,   C4,
                        0.0,  0.0,  -C4,
                         C4,  0.0,  0.0,
                        -C4,  0.0,  0.0,
                        0.0,   C4,  0.0,
                        0.0,  -C4,  0.0,
                         C0,   C2,   C3,
                         C0,   C2,  -C3,
                         C0,  -C2,   C3,
                         C0,  -C2,  -C3,
                        -C0,   C2,   C3,
                        -C0,   C2,  -C3,
                        -C0,  -C2,   C3,
                        -C0,  -C2,  -C3,
                         C3,   C0,   C2,
                         C3,   C0,  -C2,
                         C3,  -C0,   C2,
                         C3,  -C0,  -C2,
                        -C3,   C0,   C2,
                        -C3,   C0,  -C2,
                        -C3,  -C0,   C2,
                        -C3,  -C0,  -C2,
                         C2,   C3,   C0,
                         C2,   C3,  -C0,
                         C2,  -C3,   C0,
                         C2,  -C3,  -C0,
                        -C2,   C3,   C0,
                        -C2,   C3,  -C0,
                        -C2,  -C3,   C0,
                        -C2,  -C3,  -C0,
                        1.0,  1.0,  1.0,
                        1.0,  1.0, -1.0,
                        1.0, -1.0,  1.0,
                        1.0, -1.0, -1.0,
                        1.0,  1.0,  1.0,
                        1.0,  1.0, -1.0,
                        1.0, -1.0,  1.0,
                        1.0, -1.0, -1.0
                    ],
                    indices, 12.5, 1.0);

                MB.ProgramManager.addWithFun("prog", function () {
                    var prog = new MB.Program(_this.context);
                    prog.addShader("../shaders/demoShader.vert", MB.ctes.ShaderType.vertex, MB.ctes.ReadMode.read_file);
                    prog.setFooFragment();
                    prog.compile();
                    prog.use();
                    prog.addUniforms(["projection", "view", "model"]);
                    return prog;
                });
                this.cameraUpdate();

                this.renders = [
                    { name: "customHedron", y: 0.0 }
                ];
            };
            MyScene.prototype.update = function (dt) {
                this.camera.update(MB.Timer.deltaTime() / 10.0, this.cameraUpdate.bind(this));
                this.angle += MB.Timer.deltaTime() * 0.001;
                this.__resize__();
            };
            MyScene.prototype.draw = function () {
                this.clearColorAndDepth();
                var prog = MB.ProgramManager.get(this.mainShader);
                prog.use();
                var i = 0;
                this.renders.forEach(function(v) {
                    this.model =
                        this.identityMatrix.clone()
                            .translate(new MB.Vect3(-15.0 + (7.5 * 2.5), v.y, -15.0))
                            .rotate(90.0 * Math.PI / 180, MB.Vect3.yAxis)
                            .rotate(this.angle * 0.5, MB.Vect3.yAxis)
                            .scale(new MB.Vect3(2.5, 2.5, 2.5));
                    prog.sendUniformMat4("model", this.model);
                    this[v.name + i].render();
                }.bind(this));
            };
            MyScene.prototype.cameraUpdate = function () {
                this.view = this.camera.GetViewMatrix();
                this.projection = this.camera.GetProjectionMatrix(this.canvas);
                var prog = MB.ProgramManager.get(this.mainShader);
                prog.use();
                prog.sendUniformVec3("viewPos", this.camera.GetPos());
                prog.sendUniformMat4("projection", this.projection);
                prog.sendUniformMat4("view", this.view);
            };
            return MyScene;
        }(MB.App));
        window.onload = function () {
            var myScene = new MyScene();
            myScene.start();
        };
    </script>
</body>
</html>
